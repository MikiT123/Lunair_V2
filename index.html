<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lunair - Captcha Gate</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { margin:0; font-family:Arial,sans-serif; }
    #captcha-container { 
      display:flex; flex-direction:column; align-items:center; justify-content:center; 
      height:100vh; background:#f0f0f0; 
    }
    #main-site { display:none; }
    canvas { margin:10px 0; background:#eee; border-radius:5px; }
    input,button { padding:10px; font-size:16px; margin:5px; }
  </style>
</head>
<body>
  <!-- Captcha Gate -->
  <div id="captcha-container">
    <h2>Verify You're Human</h2>
    <canvas id="captcha" width="200" height="60"></canvas>
    <input type="text" id="captcha-input" placeholder="Enter Captcha">
    <button onclick="checkCaptcha()">Submit</button>
    <p id="captcha-message" style="color:red;"></p>
  </div>

  <!-- Your actual site -->
  <div id="main-site">
    <header>
      <div class="logo-container">
        <img src="Lunair.png" alt="Lunair Logo" class="logo">
      </div>
      <nav>
        <a href="index.html" class="active">Home</a>
        <a href="exercises.html">Exercises</a>
      </nav>
    </header>

    <main>
      <section class="content">
        <img src="Lunair_White.png" alt="Lunair White Logo" class="logo-white">
        <h1>Welcome to Lunair</h1>
        <p>
          Vocal Cord Dysfunction (VCD) is a condition where the vocal cords close when they should open,
          making it difficult to breathe. It can cause symptoms like shortness of breath, throat tightness,
          and voice changes. While often mistaken for asthma, VCD requires different treatments, including
          breathing exercises and speech therapy techniques.
        </p>
        <button id="toggleThemeBtn" aria-label="Toggle dark mode">Toggle Dark Mode</button>
      </section>

      <section class="info-cards">
        <div class="card">
          <img src="Lungs.png" alt="Lungs Icon">
          <h2>What is VCD?</h2>
          <p>VCD is often mistaken for asthma but requires unique treatments focused on breathing control.</p>
        </div>
        <div class="card">
          <img src="Symptoms.png" alt="Symptoms Icon">
          <h2>Symptoms</h2>
          <p>Shortness of breath, throat tightness, and voice changes during episodes.</p>
        </div>
        <div class="card">
          <img src="Treatment.png" alt="Treatment Icon">
          <h2>Treatment</h2>
          <p>Breathing exercises, speech therapy techniques, and stress management strategies.</p>
        </div>
      </section>

      <section class="cta">
        <h2>Ready to Start Your Journey?</h2>
        <p>Explore our guided breathing exercises to improve your breathing and manage VCD symptoms effectively.</p>
        <a href="exercises.html" class="cta-btn">Start Exercises</a>
      </section>
    </main>
  </div>

  <!-- FULL SCRIPT -->
  <script>
    function applyDarkModeFromStorage() {
      const prefersDark = localStorage.getItem('darkMode') === 'enabled';
      if (prefersDark) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Apply dark mode if user has preference
      applyDarkModeFromStorage();

      // Dark mode toggle logic
      const toggleBtn = document.getElementById('toggleThemeBtn');
      if (toggleBtn) {
        toggleBtn.addEventListener('click', () => {
          document.body.classList.toggle('dark-mode');
          if (document.body.classList.contains('dark-mode')) {
            localStorage.setItem('darkMode', 'enabled');
          } else {
            localStorage.setItem('darkMode', 'disabled');
          }
          const mainLogo = document.querySelector('.logo');
          const whiteLogo = document.querySelector('.logo-white');
          if (mainLogo && whiteLogo) {
            if (document.body.classList.contains('dark-mode')) {
              mainLogo.src = 'Lunair_White.png';
              whiteLogo.src = 'Lunair.png';
            } else {
              mainLogo.src = 'Lunair.png';
              whiteLogo.src = 'Lunair_White.png';
            }
          }
        });
      }

      // Captcha logic
      const captchaCanvas = document.getElementById("captcha");
      const ctx = captchaCanvas ? captchaCanvas.getContext("2d") : null;
      let captchaText = "";

      function generateCaptcha() {
        if (!ctx) return;
        ctx.clearRect(0, 0, captchaCanvas.width, captchaCanvas.height);
        captchaText = Math.random().toString(36).substring(2, 8).toUpperCase();
        ctx.font = "30px Arial";
        ctx.fillStyle = "black";
        ctx.fillText(captchaText, 40, 40);
      }

      function checkCaptcha() {
        const input = document.getElementById("captcha-input").value.toUpperCase();
        if (input === captchaText) {
          localStorage.setItem("captchaVerified", Date.now());
          document.getElementById("captcha-container").style.display = "none";
          document.getElementById("main-site").style.display = "block";
          applyDarkModeFromStorage();
        } else {
          document.getElementById("captcha-message").textContent = "Incorrect, try again.";
          generateCaptcha();
          document.getElementById("captcha-input").value = "";
        }
      }

      window.checkCaptcha = checkCaptcha;

      // On page load, decide what to show
      const lastVerified = localStorage.getItem("captchaVerified");
      if (lastVerified && Date.now() - lastVerified < 10 * 60 * 1000) {
        document.getElementById("captcha-container").style.display = "none";
        document.getElementById("main-site").style.display = "block";
        applyDarkModeFromStorage();
      } else if (captchaCanvas) {
        document.getElementById("captcha-container").style.display = "flex";
        document.getElementById("main-site").style.display = "none";
        generateCaptcha();
      }
    });
  </script>
</body>
</html>
